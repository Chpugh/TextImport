Sub ParseOpenOrders()
    Dim FilePath As String
    Dim TextLine As String
    Dim FileNum As Integer
    Dim Lines() As String
    Dim Units As Double
    Dim Price As Double
    Dim i As Integer
    Dim Pos As Integer
    
    ' Open file dialog to select the text file
    FilePath = Application.GetOpenFilename("Text Files (*.txt), *.txt, All Files (*.*), *.*", , "Select a File")
    
    If FilePath = "False" Then
        MsgBox "No file was selected.", vbExclamation
        Exit Sub
    End If
    
    ' Open the text file for reading
    FileNum = FreeFile
    Open FilePath For Input As FileNum

    ' Read all lines from the file into an array
    TextLine = Input$(LOF(FileNum), FileNum)
    Lines = Split(TextLine, vbCrLf)
    Close FileNum

    ' Loop through each line
    For i = LBound(Lines) To UBound(Lines)
        TextLine = Lines(i)
        
        ' Check for the "open order" keyword
        If InStr(TextLine, "open order") > 0 Then
            ' Extract units and price
            Pos = InStr(TextLine, "open order") + Len("open order")
            Units = GetFirstNumber(TextLine, Pos)
            Price = GetSecondNumber(TextLine, Pos + Len(CStr(Units)))
            
            ' Check if units are 0, if so, exit
            If Units = 0 Then
                Exit For
            End If
            
            ' Import price/units into row 9 columns B:E
            For j = 2 To 5
                Cells(9, j).Value = Price / Units
            Next j
            
            ' Exit the loop after processing the first "open order"
            Exit For
        End If
    Next i
End Sub

' Helper function to extract the first number from the text line
Function GetFirstNumber(ByVal TextLine As String, ByVal StartPos As Integer) As Double
    Dim Parts As Variant
    Dim i As Integer
    Dim Counter As Integer

    Parts = Split(Mid(TextLine, StartPos))
    Counter = 0

    For i = LBound(Parts) To UBound(Parts)
        If IsNumeric(Parts(i)) Then
            GetFirstNumber = CDbl(Parts(i))
            Exit Function
        End If
    Next i

    GetFirstNumber = 0
End Function

' Helper function to extract the second number from the text line
Function GetSecondNumber(ByVal TextLine As String, ByVal StartPos As Integer) As Double
    Dim Parts As Variant
    Dim i As Integer
    Dim Counter As Integer

    Parts = Split(Mid(TextLine, StartPos))
    Counter = 0

    For i = LBound(Parts) To UBound(Parts)
        If IsNumeric(Parts(i)) Then
            Counter = Counter + 1
            If Counter = 2 Then
                GetSecondNumber = CDbl(Parts(i))
                Exit Function
            End If
        End If
    Next i

    GetSecondNumber = 0
End Function
